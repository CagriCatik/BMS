<!DOCTYPE HTML>
<html lang="en" class="rust sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>SoH Algorithm - Battery Management Systems</title>


        <!-- Custom HTML head -->

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        <link rel="stylesheet" href="../src/custom.css">


        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "rust";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="../toc.js"></script>
    </head>
    <body>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('rust')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="../toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Battery Management Systems</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="state-of-health-soh-algorithm-and-implementation"><a class="header" href="#state-of-health-soh-algorithm-and-implementation">State of Health (SoH) Algorithm and Implementation</a></h1>
<h2 id="introduction"><a class="header" href="#introduction"><strong>Introduction</strong></a></h2>
<p>The <strong>State of Health (SoH)</strong> algorithm is an essential component of a Battery Management System (BMS), providing insights into the battery's condition and predicting its remaining usable capacity. This documentation delves into the theory, methodology, and technical implementation of SoH estimation, incorporating best practices and addressing challenges. The focus is on creating a seamless, detailed, and practical explanation for engineers and industry professionals.</p>
<hr />
<h2 id="state-of-health-soh-overview"><a class="header" href="#state-of-health-soh-overview"><strong>State of Health (SoH) Overview</strong></a></h2>
<h3 id="1-definition"><a class="header" href="#1-definition"><strong>1. Definition</strong></a></h3>
<p>State of Health (SoH) quantifies the battery's ability to store and deliver energy compared to its rated capacity at the time of manufacture. SoH provides a measure of battery degradation over time due to aging, cycle usage, and environmental conditions.</p>
<p>[
\text{SoH} = \frac{\text{Remaining Capacity}}{\text{Rated Capacity}} \times 100
]</p>
<h3 id="2-importance"><a class="header" href="#2-importance"><strong>2. Importance</strong></a></h3>
<ul>
<li><strong>Performance Monitoring</strong>: Ensures the battery operates within safe and optimal conditions.</li>
<li><strong>Predictive Maintenance</strong>: Alerts users when the battery requires servicing or replacement.</li>
<li><strong>Degradation Tracking</strong>: Helps in lifecycle analysis and warranty claims.</li>
</ul>
<hr />
<h2 id="cycle-dependency-in-soh-estimation"><a class="header" href="#cycle-dependency-in-soh-estimation"><strong>Cycle Dependency in SoH Estimation</strong></a></h2>
<h3 id="1-cycle-aging"><a class="header" href="#1-cycle-aging"><strong>1. Cycle Aging</strong></a></h3>
<p>Battery degradation is directly influenced by the number of charge-discharge cycles completed. Each cycle contributes to a loss in the battery's capacity.</p>
<div class="table-wrapper"><table><thead><tr><th><strong>Cycle Count</strong></th><th><strong>Remaining Capacity (% of Rated)</strong></th></tr></thead><tbody>
<tr><td>0</td><td>100%</td></tr>
<tr><td>500</td><td>90%</td></tr>
<tr><td>1000</td><td>80%</td></tr>
<tr><td>2000</td><td>70%</td></tr>
</tbody></table>
</div>
<h3 id="2-depth-of-discharge-dod"><a class="header" href="#2-depth-of-discharge-dod"><strong>2. Depth of Discharge (DoD)</strong></a></h3>
<p>The depth of discharge (DoD) represents the percentage of the battery's total capacity used in a single discharge event. Higher DoD cycles contribute more to capacity degradation.</p>
<ul>
<li><strong>Full Cycle</strong>: A full charge from 0% to 100% SoC.</li>
<li><strong>Partial Cycle</strong>: A charge or discharge event within a fraction of the total capacity (e.g., 30% to 80%).</li>
</ul>
<hr />
<h2 id="soh-algorithm-framework"><a class="header" href="#soh-algorithm-framework"><strong>SoH Algorithm Framework</strong></a></h2>
<h3 id="1-key-components"><a class="header" href="#1-key-components"><strong>1. Key Components</strong></a></h3>
<p>The SoH algorithm comprises several interconnected components:</p>
<ul>
<li><strong>Cycle Counting Algorithm</strong>: Tracks the number of charge-discharge cycles, including partial cycles.</li>
<li><strong>Cycle vs. Capacity Loss Lookup Table</strong>: Maps the number of cycles to the corresponding capacity degradation.</li>
<li><strong>Dynamic SoH Estimation</strong>: Adjusts SoH based on real-time data and past usage.</li>
</ul>
<hr />
<h3 id="2-inputs-and-outputs"><a class="header" href="#2-inputs-and-outputs"><strong>2. Inputs and Outputs</strong></a></h3>
<div class="table-wrapper"><table><thead><tr><th><strong>Input Parameter</strong></th><th><strong>Description</strong></th></tr></thead><tbody>
<tr><td><strong>Rated Capacity</strong></td><td>Original capacity at the time of manufacture (Ah).</td></tr>
<tr><td><strong>Current Capacity</strong></td><td>Capacity available at a given time (Ah).</td></tr>
<tr><td><strong>Cycle Count</strong></td><td>Number of charge-discharge cycles completed.</td></tr>
<tr><td><strong>Charge Duty and Discharge Duty (DoD)</strong></td><td>Fractional cycles based on SoC changes.</td></tr>
</tbody></table>
</div><div class="table-wrapper"><table><thead><tr><th><strong>Output Parameter</strong></th><th><strong>Description</strong></th></tr></thead><tbody>
<tr><td><strong>SoH (%)</strong></td><td>Percentage of remaining capacity.</td></tr>
<tr><td><strong>Cumulative Cycle Count</strong></td><td>Total equivalent full cycles completed.</td></tr>
<tr><td><strong>Capacity Loss</strong></td><td>Absolute and relative reduction in capacity.</td></tr>
</tbody></table>
</div>
<hr />
<h3 id="3-algorithm-steps"><a class="header" href="#3-algorithm-steps"><strong>3. Algorithm Steps</strong></a></h3>
<h4 id="step-1-calculate-equivalent-cycles"><a class="header" href="#step-1-calculate-equivalent-cycles"><strong>Step 1: Calculate Equivalent Cycles</strong></a></h4>
<p>To accurately track usage, partial cycles are aggregated into equivalent full cycles.</p>
<p>[
\text{Equivalent Cycles} = \sum \frac{\text{Cycle Contribution}}{1.0}
]</p>
<ul>
<li><strong>Cycle Contribution</strong>:
[
\text{Cycle Contribution} = 1 - \text{Charge Duty (A)} - \text{Discharge Duty (B)}
]</li>
</ul>
<p>Where ( A ) and ( B ) represent the charge and discharge fractions in decimal format (e.g., 50% = 0.5).</p>
<h4 id="step-2-retrieve-capacity-loss"><a class="header" href="#step-2-retrieve-capacity-loss"><strong>Step 2: Retrieve Capacity Loss</strong></a></h4>
<p>Use the cumulative cycle count as an input to a pre-defined <strong>Cycle vs. Capacity Loss Lookup Table</strong> to estimate the remaining capacity.</p>
<h4 id="step-3-compute-soh"><a class="header" href="#step-3-compute-soh"><strong>Step 3: Compute SoH</strong></a></h4>
<p>Calculate SoH using the formula:
[
\text{SoH} = \frac{\text{Remaining Capacity}}{\text{Rated Capacity}} \times 100
]</p>
<h4 id="step-4-cumulative-tracking"><a class="header" href="#step-4-cumulative-tracking"><strong>Step 4: Cumulative Tracking</strong></a></h4>
<ul>
<li>Store cumulative cycle data in non-volatile memory to ensure long-term tracking.</li>
<li>Periodically update and calibrate SoH based on real-time and historical data.</li>
</ul>
<hr />
<h2 id="algorithm-design-advanced-implementation"><a class="header" href="#algorithm-design-advanced-implementation"><strong>Algorithm Design: Advanced Implementation</strong></a></h2>
<h3 id="1-data-storage-and-memory-management"><a class="header" href="#1-data-storage-and-memory-management"><strong>1. Data Storage and Memory Management</strong></a></h3>
<ul>
<li><strong>Memory Requirements</strong>: Non-volatile memory (e.g., EEPROM, flash) to store cycle counts and capacity degradation data.</li>
<li><strong>Optimization</strong>: Compress historical data or periodically reset less significant cycle data.</li>
</ul>
<h3 id="2-handling-partial-cycles"><a class="header" href="#2-handling-partial-cycles"><strong>2. Handling Partial Cycles</strong></a></h3>
<h4 id="duty-calculation"><a class="header" href="#duty-calculation"><strong>Duty Calculation</strong></a></h4>
<ul>
<li><strong>Charge Duty</strong>:
[
\text{Duty}<em>{\text{charge}} = \frac{\text{End SoC}</em>{\text{charge}} - \text{Start SoC}_{\text{charge}}}{100}
]</li>
<li><strong>Discharge Duty</strong>:
[
\text{Duty}<em>{\text{discharge}} = \frac{\text{Start SoC}</em>{\text{discharge}} - \text{End SoC}_{\text{discharge}}}{100}
]</li>
</ul>
<h4 id="cycle-aggregation"><a class="header" href="#cycle-aggregation"><strong>Cycle Aggregation</strong></a></h4>
<p>Sum the duties to calculate the equivalent full cycles:
[
\text{Cycle Count} = \text{Previous Cycles} + \frac{\text{Duty}<em>{\text{charge}} + \text{Duty}</em>{\text{discharge}}}{1.0}
]</p>
<hr />
<h3 id="3-matlab-implementation"><a class="header" href="#3-matlab-implementation"><strong>3. MATLAB Implementation</strong></a></h3>
<h4 id="pseudo-code"><a class="header" href="#pseudo-code"><strong>Pseudo-Code</strong></a></h4>
<pre><code class="language-matlab">% Define battery parameters
rated_capacity = 100; % in Ah
current_cycles = 0; % Initialize total cycles

% Define Lookup Table (Cycle vs Capacity Loss)
lookup_table = [0, 100; 500, 90; 1000, 80; 2000, 70]; % Cycle vs % Capacity

% Input: Charge and Discharge Duty
charge_duty = 0.4; % 40% charge duty
discharge_duty = 0.5; % 50% discharge duty

% Step 1: Calculate Equivalent Cycles
cycle_contribution = 1 - charge_duty - discharge_duty;
current_cycles = current_cycles + cycle_contribution;

% Step 2: Retrieve Capacity Loss
remaining_capacity = interp1(lookup_table(:,1), lookup_table(:,2), current_cycles, 'linear', 'extrap');

% Step 3: Compute State of Health (SoH)
SoH = (remaining_capacity / rated_capacity) * 100;

% Output Results
disp(['Total Cycles: ', num2str(current_cycles)]);
disp(['Remaining Capacity: ', num2str(remaining_capacity), ' Ah']);
disp(['State of Health (SoH): ', num2str(SoH), '%']);
</code></pre>
<hr />
<h3 id="4-integration-with-other-bms-functions"><a class="header" href="#4-integration-with-other-bms-functions"><strong>4. Integration with Other BMS Functions</strong></a></h3>
<ul>
<li><strong>State of Charge (SoC)</strong>: Integrate SoH estimation with real-time SoC monitoring for enhanced accuracy.</li>
<li><strong>Fault Detection</strong>: Use SoH to detect abnormal degradation and trigger fault alarms.</li>
</ul>
<hr />
<h2 id="challenges-in-soh-estimation"><a class="header" href="#challenges-in-soh-estimation"><strong>Challenges in SoH Estimation</strong></a></h2>
<h3 id="1-sensor-inaccuracies"><a class="header" href="#1-sensor-inaccuracies"><strong>1. Sensor Inaccuracies</strong></a></h3>
<p>Voltage and current sensor noise or drift can impact the accuracy of duty and cycle calculations.</p>
<h4 id="mitigation"><a class="header" href="#mitigation"><strong>Mitigation</strong>:</a></h4>
<ul>
<li>Implement filtering techniques (e.g., Kalman filters).</li>
<li>Periodically calibrate sensors with reference values.</li>
</ul>
<h3 id="2-environmental-variability"><a class="header" href="#2-environmental-variability"><strong>2. Environmental Variability</strong></a></h3>
<p>Temperature and load variations can accelerate degradation unpredictably.</p>
<h4 id="mitigation-1"><a class="header" href="#mitigation-1"><strong>Mitigation</strong>:</a></h4>
<ul>
<li>Use temperature-compensated SoH models.</li>
<li>Introduce adaptive algorithms that account for environmental factors.</li>
</ul>
<h3 id="3-long-term-data-management"><a class="header" href="#3-long-term-data-management"><strong>3. Long-Term Data Management</strong></a></h3>
<p>Storing large amounts of cycle data in non-volatile memory is resource-intensive.</p>
<h4 id="mitigation-2"><a class="header" href="#mitigation-2"><strong>Mitigation</strong>:</a></h4>
<ul>
<li>Periodically aggregate historical data.</li>
<li>Store only critical points (e.g., significant degradation milestones).</li>
</ul>
<hr />
<h2 id="future-enhancements"><a class="header" href="#future-enhancements"><strong>Future Enhancements</strong></a></h2>
<h3 id="1-predictive-soh-algorithms"><a class="header" href="#1-predictive-soh-algorithms"><strong>1. Predictive SoH Algorithms</strong></a></h3>
<ul>
<li>Employ machine learning models to forecast SoH based on historical data and usage trends.</li>
</ul>
<h3 id="2-dynamic-aging-models"><a class="header" href="#2-dynamic-aging-models"><strong>2. Dynamic Aging Models</strong></a></h3>
<ul>
<li>Develop aging models that dynamically adjust for usage patterns, temperature, and other real-world conditions.</li>
</ul>
<h3 id="3-real-time-embedded-systems"><a class="header" href="#3-real-time-embedded-systems"><strong>3. Real-Time Embedded Systems</strong></a></h3>
<ul>
<li>Deploy the algorithm on microcontrollers or FPGA platforms for real-time SoH monitoring.</li>
</ul>
<hr />
<h2 id="conclusion"><a class="header" href="#conclusion"><strong>Conclusion</strong></a></h2>
<p>The SoH algorithm provides a robust framework for monitoring battery health, enabling predictive maintenance, safety, and optimal performance. By integrating cycle counting, capacity degradation models, and real-time monitoring, engineers can achieve accurate and reliable SoH estimation. The detailed methodology and MATLAB implementation presented here offer a solid foundation for further development and integration into BMS systems.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../system_and_algorithms/cycle_counting_soh.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../system_and_algorithms/cell_balancing.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../system_and_algorithms/cycle_counting_soh.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../system_and_algorithms/cell_balancing.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../elasticlunr.min.js"></script>
        <script src="../mark.min.js"></script>
        <script src="../searcher.js"></script>

        <script src="../clipboard.min.js"></script>
        <script src="../highlight.js"></script>
        <script src="../book.js"></script>

        <!-- Custom JS scripts -->


    </div>
    </body>
</html>
