<!DOCTYPE HTML>
<html lang="en" class="rust sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Battery Management System Development in Simulink - Battery Management Systems</title>


        <!-- Custom HTML head -->

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        <link rel="stylesheet" href="../src/custom.css">


        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "rust";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="../toc.js"></script>
    </head>
    <body>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('rust')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="../toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Battery Management Systems</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="battery-management-system-development-in-simulink"><a class="header" href="#battery-management-system-development-in-simulink">Battery Management System Development in Simulink</a></h1>
<h2 id="introduction"><a class="header" href="#introduction">Introduction</a></h2>
<p>Battery Management Systems (BMS) are critical components in modern battery-powered systems, ensuring safety, efficiency, and longevity of batteries. In electric vehicles (EVs), the BMS monitors and controls the battery pack, balancing cells, preventing unsafe conditions, and optimizing performance. This documentation outlines the design, simulation, and development of a BMS using Simulink, detailing the components, algorithms, and methodologies involved.</p>
<hr />
<h2 id="1-battery-management-system-overview"><a class="header" href="#1-battery-management-system-overview">1. Battery Management System Overview</a></h2>
<p>The primary objective of a BMS is to manage and safeguard the battery system by monitoring its key parameters, such as voltage, temperature, current, and state of charge (SOC). Additionally, the BMS protects the battery from operating outside its safe limits, optimizes energy usage through cell balancing, and provides diagnostics and reporting for maintenance and performance evaluation. In the context of electric vehicles, the BMS ensures that the battery operates safely across different environmental conditions, drive cycles, and charging profiles. The ability to simulate such scenarios is crucial for understanding and mitigating potential issues without risking damage to actual battery packs.</p>
<h3 id="11-purpose"><a class="header" href="#11-purpose">1.1 Purpose</a></h3>
<p>The BMS ensures the following:</p>
<ul>
<li><strong>Monitoring:</strong> Tracks critical parameters such as temperature, voltage, current, and state of charge (SOC).</li>
<li><strong>Protection:</strong> Prevents operations outside safe limits to avoid thermal runaway, overcharging, or deep discharge.</li>
<li><strong>Optimization:</strong> Balances cell voltages and SOC for maximum performance.</li>
<li><strong>Diagnostics and Reporting:</strong> Provides insights for maintenance and performance evaluation.</li>
</ul>
<h3 id="12-use-case"><a class="header" href="#12-use-case">1.2 Use Case</a></h3>
<p>In the context of EVs, the BMS enables:</p>
<ul>
<li>Safe operation across varying environmental conditions.</li>
<li>Evaluation of battery responses to diverse drive cycles and charging profiles.</li>
<li>Protection against unsafe conditions such as over-temperature or under-voltage.</li>
</ul>
<hr />
<h2 id="2-simulation-model-in-simulink"><a class="header" href="#2-simulation-model-in-simulink">2. Simulation Model in Simulink</a></h2>
<p>The BMS simulation model is implemented in Simulink and is organized into several interconnected subsystems that replicate the functionality of a real-world BMS. These subsystems include driving scenario definitions, fault indicators, the BMS ECU model, and the battery pack along with its associated circuitry.</p>
<p>At the top level, the model defines various driving scenarios that serve as test sequences for evaluating the BMS. Fault indicators within the model provide visual feedback on whether any unsafe condition, such as over-temperature or over-voltage, has occurred. The core BMS logic resides in the BMS ECU model, which implements monitoring, control, and balancing algorithms. The battery pack and its circuitry are represented using Simscape, which accurately models their physical and electrical characteristics.</p>
<p>The model incorporates two variants of battery packs. The first is a small pack with six cells connected in series, while the second is a larger pack with 16 modules, each containing six cells in series, resulting in a total of 96 cells. These packs are modeled as a single parallel string. Simscape enables a detailed representation of these battery packs, using distinct physical domains such as electrical and thermal to capture their behavior under varying conditions.</p>
<h3 id="21-model-architecture"><a class="header" href="#21-model-architecture">2.1 Model Architecture</a></h3>
<p>The BMS model in Simulink consists of:</p>
<ul>
<li><strong>Driving Scenarios Subsystem:</strong> Defines test sequences for driving and charging cycles.</li>
<li><strong>Fault Indicators:</strong> Detects conditions like over-temperature or over-voltage.</li>
<li><strong>BMS ECU Model:</strong> Implements monitoring, control, and balancing algorithms.</li>
<li><strong>Battery Pack and Circuitry Representation:</strong> Models the physical and electrical characteristics of the battery.</li>
</ul>
<h3 id="22-battery-pack-variants"><a class="header" href="#22-battery-pack-variants">2.2 Battery Pack Variants</a></h3>
<ul>
<li><strong>Small Pack:</strong> Six cells in series modeled in Simscape.</li>
<li><strong>Large Pack:</strong> Sixteen modules, each with six cells in series, resulting in 96 cells.</li>
</ul>
<h3 id="23-physical-domains"><a class="header" href="#23-physical-domains">2.3 Physical Domains</a></h3>
<ul>
<li><strong>Electrical (Blue):</strong> Models voltage, current, and resistance.</li>
<li><strong>Thermal (Orange):</strong> Models heat dissipation and thermal gradients.</li>
</ul>
<hr />
<h2 id="3-battery-pack-design-and-characteristics"><a class="header" href="#3-battery-pack-design-and-characteristics">3. Battery Pack Design and Characteristics</a></h2>
<p>The battery pack design is fundamental to the BMS. Each cell in the pack is modeled to reflect real-life lithium-ion chemistries, such as Nickel Manganese Cobalt (NMC). The cells are connected in series, allowing for heat exchange between adjacent cells. However, the thermal layout is asymmetrical, with significant differences in thermal behavior between cells.</p>
<p>For example, in the six-cell configuration, cell 6 is thermally insulated on one side, while cell 1 is exposed to the ambient air, allowing for convective cooling. This asymmetry creates notable temperature gradients within the pack, with cell 6 experiencing higher temperatures than cell 1. Such gradients are critical in understanding thermal management needs and their impact on cell degradation and performance.</p>
<p>Each cell is represented by an equivalent circuit model that simulates its electrical behavior. This model includes parameters that account for dependencies on temperature, SOC, and aging. These parameters are derived from experimental data, ensuring that the simulation closely mirrors real-world battery behavior.</p>
<h3 id="31-cell-configuration"><a class="header" href="#31-cell-configuration">3.1 Cell Configuration</a></h3>
<p>Cells are connected in series:</p>
<ul>
<li>Heat exchange occurs between cells.</li>
<li>Asymmetrical thermal layout:
<ul>
<li>Cell 6: Insulated on one side.</li>
<li>Cell 1: Exposed to ambient air for convective cooling.</li>
</ul>
</li>
</ul>
<h3 id="32-equivalent-circuit-model"><a class="header" href="#32-equivalent-circuit-model">3.2 Equivalent Circuit Model</a></h3>
<p>Represents real-life lithium-ion chemistries (e.g., Nickel Manganese Cobalt, NMC):</p>
<ul>
<li>Includes temperature, SOC, and aging dependencies.</li>
<li>Parameter estimation aligns with experimental data.</li>
</ul>
<hr />
<h2 id="4-bms-algorithms"><a class="header" href="#4-bms-algorithms">4. BMS Algorithms</a></h2>
<p>The BMS algorithms are designed to monitor, protect, and optimize the battery system. These algorithms include current limiting, state-of-charge estimation, cell balancing, and state machine logic.</p>
<p>The monitoring subsystem calculates maximum allowable charge and discharge current levels based on individual cell voltages and temperatures. For instance, at low SOC, a cell's voltage is low, and allowing it to deliver a large current could cause its voltage to drop below the cutoff threshold specified by the manufacturer. By comparing the minimum cell voltage against this threshold and dividing it by the maximum internal resistance, the system computes a voltage-based current limit.</p>
<p>Temperature-based current thresholds are also implemented using lookup tables. These thresholds prevent high or low temperatures from causing physical damage to the cell materials during charging or discharging. The system compares these thresholds and selects the lowest value as the current limit.</p>
<p>The state machine, implemented using Simulink Stateflow, governs the overall operation of the BMS. It includes four parallel states: the main operating state (standby, driving, charging, or fault), fault detection, and the contactor switching sequences for the charger and inverter. The contactor logic ensures that excessive inrush currents are avoided during charging.</p>
<h3 id="41-monitoring-and-current-limiting"><a class="header" href="#41-monitoring-and-current-limiting">4.1 Monitoring and Current Limiting</a></h3>
<ul>
<li><strong>Low SOC:</strong> Limits current to prevent excessive voltage drops below the cutoff.</li>
<li><strong>Temperature-Based Thresholds:</strong> Lookup tables set current limits for safe operation at high and low temperatures.</li>
</ul>
<h3 id="42-state-machine"><a class="header" href="#42-state-machine">4.2 State Machine</a></h3>
<p>Modeled using Simulink Stateflow, the state machine includes:</p>
<ul>
<li><strong>BMS States:</strong> Standby, Driving, Charging, and Fault.</li>
<li><strong>Parallel States:</strong> Fault detection, contactor switching for charger/inverter, and state-specific logic.</li>
</ul>
<hr />
<h2 id="5-state-of-charge-soc-estimation-methods"><a class="header" href="#5-state-of-charge-soc-estimation-methods">5. State of Charge (SOC) Estimation Methods</a></h2>
<p>The state of charge (SOC) is a critical parameter that indicates the remaining energy in the battery. Since SOC cannot be measured directly, the BMS relies on estimation techniques. Three methods are implemented in the simulation: Coulomb counting, the Extended Kalman Filter (EKF), and the Unscented Kalman Filter (UKF).</p>
<p>Coulomb counting calculates SOC by integrating the current entering and leaving the cell over time. Although computationally efficient, this method suffers from cumulative errors and lacks the ability to correct inaccuracies without feedback from voltage measurements.</p>
<p>The EKF and UKF, on the other hand, are variations of nonlinear Kalman filters that use a cell model to predict terminal voltage based on current input. They then compare this prediction with actual measurements to estimate SOC and other internal states. The EKF is typically sufficient for systems with mild nonlinearity, such as the voltage-SOC relationship in lithium-ion cells. Both Kalman filters demonstrated the ability to recover from an initial SOC estimation error during the simulation, with the EKF slightly outperforming the UKF.</p>
<h3 id="51-methods"><a class="header" href="#51-methods">5.1 Methods</a></h3>
<ol>
<li><strong>Coulomb Counting:</strong>
<ul>
<li>Tracks charge based on current flow.</li>
<li>Low computational cost but accumulates errors over time.</li>
</ul>
</li>
<li><strong>Extended Kalman Filter (EKF):</strong>
<ul>
<li>Nonlinear estimation using voltage and current data.</li>
<li>Suitable for mild system nonlinearities.</li>
</ul>
</li>
<li><strong>Unscented Kalman Filter (UKF):</strong>
<ul>
<li>Similar to EKF but better for severe nonlinearities.</li>
</ul>
</li>
</ol>
<h3 id="52-performance-comparison"><a class="header" href="#52-performance-comparison">5.2 Performance Comparison</a></h3>
<ul>
<li>EKF and UKF recover from initial SOC errors, with EKF slightly outperforming UKF.</li>
<li>Coulomb counting lacks feedback for error correction.</li>
</ul>
<hr />
<h2 id="6-cell-balancing"><a class="header" href="#6-cell-balancing">6. Cell Balancing</a></h2>
<p>Cell balancing ensures that all cells in the pack have a similar SOC. Without balancing, cells with higher SOC levels limit the total capacity that can be utilized, leading to inefficiencies. The balancing logic in the BMS calculates the voltage difference between the highest and lowest cell voltages and activates resistive balancing circuits as needed. These circuits discharge cells with higher SOC, gradually equalizing their charge levels.</p>
<h3 id="61-purpose"><a class="header" href="#61-purpose">6.1 Purpose</a></h3>
<p>Maintains uniform SOC across cells to:</p>
<ul>
<li>Maximize capacity utilization.</li>
<li>Reduce degradation rates.</li>
</ul>
<h3 id="62-balancing-logic"><a class="header" href="#62-balancing-logic">6.2 Balancing Logic</a></h3>
<ul>
<li>Voltage difference triggers balancing.</li>
<li>Resistors discharge cells with higher SOC.</li>
<li>Balancing commands are boolean vectors activating resistors.</li>
</ul>
<hr />
<h2 id="7-thermal-management"><a class="header" href="#7-thermal-management">7. Thermal Management</a></h2>
<p>Thermal management addresses the temperature gradients caused by the asymmetrical thermal layout of the battery pack. For example, in the six-cell configuration, cell 6 heats up significantly more than cell 1 due to its insulation. Such thermal imbalances can lead to uneven aging and degradation of cells, reducing the overall lifespan of the battery pack. Active thermal management strategies are necessary to minimize these differences and maintain cell temperatures within a safe range.</p>
<h3 id="71-thermal-asymmetry"><a class="header" href="#71-thermal-asymmetry">7.1 Thermal Asymmetry</a></h3>
<ul>
<li>Causes temperature gradients across cells.</li>
<li>Cell 6 (insulated) heats faster than Cell 1 (exposed).</li>
</ul>
<h3 id="72-active-management"><a class="header" href="#72-active-management">7.2 Active Management</a></h3>
<ul>
<li>Equalizes cell temperatures.</li>
<li>Prevents accelerated degradation of hotter cells.</li>
</ul>
<hr />
<h2 id="8-simulation-insights"><a class="header" href="#8-simulation-insights">8. Simulation Insights</a></h2>
<p>The simulation results highlight the importance of proper design and management of the battery system. During the driving, charging, and balancing sequences, the individual cell voltages initially exhibit differences due to SOC imbalances. These differences converge over time as the balancing algorithm is applied.</p>
<p>The current limiting algorithm demonstrated its effectiveness in preventing unsafe operating conditions by dynamically adjusting current thresholds based on cell voltages and temperatures. The simulation also revealed the limitations of Coulomb counting for SOC estimation, as it failed to recover from initial errors, unlike the Kalman filter methods.</p>
<p>Temperature traces showed significant discrepancies between the hottest and coldest cells, emphasizing the need for robust thermal management solutions. The results also underscored the benefits of using more accurate resistance-based current limiting approaches, which consider real-time SOC and temperature data.</p>
<h3 id="81-results"><a class="header" href="#81-results">8.1 Results</a></h3>
<ol>
<li><strong>Voltage Behavior:</strong>
<ul>
<li>Voltage differences at the start due to SOC imbalance.</li>
<li>Convergence after balancing procedure.</li>
</ul>
</li>
<li><strong>Current Limiting:</strong>
<ul>
<li>Conservative limits based on maximum resistance.</li>
<li>Optimized limits use SOC and temperature data.</li>
</ul>
</li>
<li><strong>Temperature Variance:</strong>
<ul>
<li>Uneven heating highlights the need for thermal management.</li>
</ul>
</li>
</ol>
<h3 id="82-soc-estimation"><a class="header" href="#82-soc-estimation">8.2 SOC Estimation</a></h3>
<ul>
<li>Coulomb counting fails to correct initial errors.</li>
<li>Kalman filter methods recover accuracy within simulated time.</li>
</ul>
<hr />
<h2 id="9-practical-considerations"><a class="header" href="#9-practical-considerations">9. Practical Considerations</a></h2>
<h3 id="91-precharge-circuitry"><a class="header" href="#91-precharge-circuitry">9.1 Precharge Circuitry</a></h3>
<p>Prevents inrush currents during connection to a charger:</p>
<ul>
<li>Sequential preconnection via resistors.</li>
</ul>
<h3 id="92-load-and-charging-profiles"><a class="header" href="#92-load-and-charging-profiles">9.2 Load and Charging Profiles</a></h3>
<ul>
<li>Represented by current sources.</li>
<li>Follow predefined driving and charging sequences.</li>
</ul>
<hr />
<h2 id="10-summary"><a class="header" href="#10-summary">10. Summary</a></h2>
<p>The Simulink-based BMS model provides a comprehensive platform for:</p>
<ul>
<li><strong>Simulation:</strong> Testing various operational scenarios without physical risk.</li>
<li><strong>Validation:</strong> Ensuring safety and performance across diverse conditions.</li>
<li><strong>Development:</strong> Supporting robust design of algorithms for monitoring, balancing, and thermal management.</li>
</ul>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../advanced_applications.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../advanced_applications/bms_testing_intro.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../advanced_applications.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../advanced_applications/bms_testing_intro.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../elasticlunr.min.js"></script>
        <script src="../mark.min.js"></script>
        <script src="../searcher.js"></script>

        <script src="../clipboard.min.js"></script>
        <script src="../highlight.js"></script>
        <script src="../book.js"></script>

        <!-- Custom JS scripts -->


    </div>
    </body>
</html>
